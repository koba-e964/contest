区間 $[A_i, i]$ ($1 \le i \le N$) を考えると、$N$ 個の区間は交差しない。つまり、 $l_1 = A_{r_1} < l_2 = A_{r_2} < r_1 < r_2$ となった場合、 $P_{l_2} < P_{r_2}, P_{l_2} > P_{r_1}, P_{r_1} > P_{r_2}$ となってしまい矛盾する。つまり $A_j < i < j$ に対して $A_i \ge A_j$ である。

区間は入れ子状になるのだから、再帰的に考えてどうにかなりそう。
区間 $[A_i, i]$ に対しては、 $P_i$ は $i <j$ なる $P_j$ に対して「義理立て」する必要がある ($P_i < P_j$ である必要がある) が、 $(A_i, i)$ についてはそのような義理立ては必要ない。 $[A_i, i]$ の内部では、 $[A_i, i]$ だけが世界の全てであるかのように計算すれば良くて、「義理立て」しない部分を勘定するのは $[A_i, i]$ の役目である。($(A_i, i)$ の要素を $(i, \infty)$ の要素と組み合わせて並べる。普通の combination でできる。)
